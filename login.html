<html>
<head>
    <script src="http://chatroom.bmob.cn/javascripts/jquery.min.js"></script>
    <script src="http://chatroom.bmob.cn/javascripts/bmob.js"></script>
    <script src="http://chatroom.bmob.cn/javascripts/bmobSocketIo.js"></script>
</head>
<body>

<table>
<tr><td>用户名</td><td><input type="text" id="userId" value="Id"></input></td></tr>
<tr><td>密码</td><td><input type="text" id="userPass" value="Pass"></input></td></tr>
<tr><td>邮箱</td><td><input type="text" id="userEmail" value="Email"></input></td></tr>
<tr><td>电话</td><td><input type="text" id="userTel" value="Tel"></input></td></tr>
<tr><td><input type="button" onclick="sign();" value="注册"></input></td>
<td><input type="button" onclick="login();" value="登陆"></input></td></tr>
</table>


<script>

    function sign()
    {
        $.ajax({ 
            type: 'POST',
            url:'https://api.bmob.cn/1/users', 
            beforeSend: function (request)
            {
                request.setRequestHeader("X-Bmob-Application-Id", "4733f138065d979e5bea5a43bd4bdf0a");
                request.setRequestHeader("X-Bmob-REST-API-Key", "e78ae2b9cf7e63e9066f6336a6822a1c");
            },
            // headers:{'X-Bmob-Application-Id':'4733f138065d979e5bea5a43bd4bdf0a',
            //          'X-Bmob-REST-API-Key':'e78ae2b9cf7e63e9066f6336a6822a1c'},
            dataType:'application/json', 
            data:{"username":document.getElementById("userId").value,"password":document.getElementById("userPass").value,"phone":document.getElementById("userTel").value}, 
            //jsonp:'callback', 
            success:function(result) { 
                console.log("sign success!");
                   //result.results[0].totalPV
            //   $('#lb_count').html(result.results[0].totalPV);
            //   //更新次数
            //   setTotalPV();
            }     
        });    
    }  
    
function sign2(){


Bmob.initialize("4733f138065d979e5bea5a43bd4bdf0a", "e78ae2b9cf7e63e9066f6336a6822a1c");
var user = new Bmob.User();
user.set("username", document.getElementById("userId").value);
user.set("password", document.getElementById("userPass").value);
user.set("email", document.getElementById("userEmail").value);

// other fields can be set just like with Bmob.Object
user.set("phone", document.getElementById("userTel").value);

user.save(null, {
  success: function(user) {
    // Hooray! Let them use the app now.
    console.log("success");
  },
  error: function(user, error) {
    // Show the error message somewhere and let the user try again.
    alert("Error: " + error.code + " " + error.message);
  }
});
}

function login(){
Bmob.initialize("4733f138065d979e5bea5a43bd4bdf0a", "e78ae2b9cf7e63e9066f6336a6822a1c");
var UserInfo = Bmob.Object.extend("_User");
var query = new Bmob.Query(UserInfo);
query.equalTo("username", document.getElementById("userId").value); 
query.equalTo("password", document.getElementById("userPass").value); 
// 查询所有数据
query.find({
    success: function(results) {
        if(results.length == "1"){console.log("login success!");}
        else{console.log("login failed!");}
        
        /*alert("共查询到 " + results.length + " 条记录");
        // 循环处理查询到的数据
        for (var i = 0; i < results.length; i++) {
        var object = results[i];
        alert(object.id + ' - ' + object.get('username'));
        }*/
    },
    error: function(error) {
        console.log("login failed!");
        alert("用户名或密码不正确！");
    }
});
}
</script>
</body>
</html>
